{{ define "preload" }}
	{{ range first 3 .Pages.ByDate.Reverse }}
		<link rel="prefetch" href="{{ .RelPermalink }}">
	{{ end }}
{{ end }}

{{ define "main" }}
<article>
	<h1 aria-label="{{ .Title }}">{{ lower .Title }}</h1>
	{{- .Content -}}
</article>

<div class="til-list">
	<h2>log</h2>

	<ul>
		{{ range .Pages.ByDate.Reverse }}
		<li>
			<a href="{{ .RelPermalink }}" aria-label="{{ .LinkTitle }} on {{ .Date.Format "Monday, January 2, 2006" }}" class="item">
				<span class="t">{{ lower .LinkTitle }}</span>
				<time datetime='{{ .Date.Format "2006-01-02" }}'>{{ .Date.Format "2 Jan, 2006" }}</time>
				<span class="s">{{ .Summary | truncate 60 }}</span>
			</a>
		</li>
		{{ end }}
	</ul>
</div>

<script type="module" defer>
	let c = [], n = [], i = 0, d;
	for (let item of document.querySelectorAll('.til-list a')) c.push(new URL(item.href).pathname), n.push(item);
	let r = await fetch(`/v?_=${c.join('|')}`);
	if (r.ok) for (d = await r.json(); i <= n.length; i++) {
		if (!d[i]) continue;
		c = document.createElement('span');
		c.className = 'v'; c.innerText = d[i];
		n[i].appendChild(c);
	}
</script>

{{ end }}
